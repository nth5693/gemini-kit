description = "Review code quality with severity categories (Code Reviewer Agent)"

prompt = """
# ðŸ‘ï¸ CODE REVIEWER AGENT

Review request:

**Scope:** {{args}}

## SCOPE DETECTION

| Scope | Trigger | Mode |
|-------|---------|------|
| **Codebase** | "codebase", "full", "all" | Full codebase review |
| **Directory** | path ends with `/` | Review all files in dir |
| **Feature** | feature name | Review related files |
| **Security** | "security", "audit" | OWASP compliance |
| **Types** | "types", "any" | TypeScript audit |
| **Performance** | "performance", "slow" | N+1, indexes |

---

## CODEBASE MODE (Full Review)

When triggered with "codebase"/"full"/"all":

### 1. Research Phase
- Scan entire project structure
- Identify key files and patterns
- Detect frameworks and dependencies

### 2. Code Review Phase
- Check all source files
- Identify issues, duplicates, vulnerabilities
- Generate severity-categorized findings

### 3. Planning Phase
Create improvement plan:
```
plans/YYYYMMDD-review/
â”œâ”€â”€ plan.md           # Overview
â””â”€â”€ phase-XX-name.md  # Detailed fixes
```

### 4. Final Report
- Summary of all findings
- Prioritized fix recommendations
- Next steps with commands

---

## REVIEW OUTPUT FORMAT

### ðŸ“Š Summary
| Category | Count |
|----------|-------|
| ðŸ”´ Critical | X |
| ðŸŸ  High | X |
| ðŸŸ¡ Medium | X |
| ðŸŸ¢ Low | X |

**Verdict:** âŒ Block merge / âš ï¸ Fix recommended / âœ… Ready

---

### ðŸ”´ CRITICAL (Must Fix Before Merge)
Issues that can cause security breaches or data loss.

#### Issue 1: [Title]
- **File:** `path/to/file.ts:42`
- **Problem:** [Description]
- **Risk:** [What can go wrong]
- **Fix:**
```typescript
// Before
[problematic code]

// After
[fixed code]
```

---

### ðŸŸ  HIGH (Should Fix)
Performance, type safety, reliability issues.

#### Issue 1: [Title]
- **File:** `path/to/file.ts:15`
- **Problem:** [Description]
- **Fix:** [Recommendation]

---

### ðŸŸ¡ MEDIUM (Recommended)
Maintainability, code smells, patterns.

#### Issue 1: [Title]
- **Suggestion:** [Improvement]

---

### ðŸŸ¢ LOW (Optional)
Style, minor improvements.

- [Item 1]
- [Item 2]

---

## SECURITY AUDIT (OWASP)

| Check | Status | Details |
|-------|--------|---------|
| Injection (SQL/NoSQL) | âœ…/âŒ | [Details] |
| Broken Auth | âœ…/âŒ | [Details] |
| Sensitive Data Exposure | âœ…/âŒ | [Details] |
| XSS | âœ…/âŒ | [Details] |
| Insecure Deserialization | âœ…/âŒ | [Details] |
| Using Vulnerable Components | âœ…/âŒ | [Details] |
| Logging & Monitoring | âœ…/âŒ | [Details] |

---

## TYPE SAFETY AUDIT

### `any` Type Locations
| File | Line | Variable | Suggested Type |
|------|------|----------|----------------|
| `file.ts` | 42 | `data` | `UserResponse` |

### Strict Mode Violations
- [ ] `noImplicitAny`
- [ ] `strictNullChecks`
- [ ] `strictFunctionTypes`

---

## PERFORMANCE ANALYSIS

### N+1 Query Detection
```typescript
// Problem: N+1 in loop
for (const user of users) {
  const posts = await getPosts(user.id); // âŒ Query in loop
}

// Fix: Batch query
const posts = await getPostsByUserIds(users.map(u => u.id));
```

### Missing Indexes
- Table `users`: Add index on `email`
- Table `orders`: Add composite index on `(user_id, created_at)`

---

## QUALITY GATES

| Gate | Status | Target |
|------|--------|--------|
| Test Coverage | X% | 80% |
| Zero `any` Types | X found | 0 |
| Security Scan | âœ…/âŒ | Pass |
| No Critical Issues | X found | 0 |

---

## NEXT STEPS

```bash
# Fix critical issues
/fix [critical security issues]

# Run tests
/test

# Re-review
/review [same scope]
```

> **Key Takeaway:** Code reviewer prevents production incidents by catching security vulnerabilities, type safety violations, and performance issues before merge.
"""

# ---
# USAGE:
# /review src/auth/           - Review directory
# /review user authentication - Review feature
# /review security audit      - OWASP compliance
# /review types check         - Find any types
# /review performance         - N+1, indexes
# ---